{"dependencies":[{"name":"react","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":1,"column":0,"index":0},"end":{"line":1,"column":26,"index":26}}],"key":"RtGiGa+/H7VrI7GDQDLhO1UbpU8=","exportNames":["*"],"imports":1}},{"name":"react-native-web/dist/exports/View","data":{"asyncType":null,"isESMImport":false,"locs":[],"key":"4kYBDC6LJJXoH7P9rWDi3vkLVB0=","exportNames":["*"],"imports":1}},{"name":"react-native-web/dist/exports/StyleSheet","data":{"asyncType":null,"isESMImport":false,"locs":[],"key":"MK7+k1V+KnvCVW7Kj2k/ydtjmVU=","exportNames":["*"],"imports":1}},{"name":"react-native-webview","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":3,"column":0,"index":86},"end":{"line":3,"column":47,"index":133}}],"key":"YJc7i/oIweCWhKjzjfYLEcLeUJA=","exportNames":["*"],"imports":1}},{"name":"react/jsx-dev-runtime","data":{"asyncType":null,"isESMImport":false,"locs":[],"key":"L9D70Z4hi4aGuui1ysja/oQ5ytI=","exportNames":["*"],"imports":1}}],"output":[{"data":{"code":"__d(function (global, require, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  \"use strict\";\n\n  var _jsxFileName = \"/app/frontend/components/LeafletMap.tsx\";\n  Object.defineProperty(exports, '__esModule', {\n    value: true\n  });\n  function _interopDefault(e) {\n    return e && e.__esModule ? e : {\n      default: e\n    };\n  }\n  Object.defineProperty(exports, \"default\", {\n    enumerable: true,\n    get: function () {\n      return _default;\n    }\n  });\n  Object.defineProperty(exports, \"LeafletMap\", {\n    enumerable: true,\n    get: function () {\n      return LeafletMap;\n    }\n  });\n  require(_dependencyMap[0], \"react\");\n  var _reactNativeWebDistExportsView = require(_dependencyMap[1], \"react-native-web/dist/exports/View\");\n  var View = _interopDefault(_reactNativeWebDistExportsView);\n  var _reactNativeWebDistExportsStyleSheet = require(_dependencyMap[2], \"react-native-web/dist/exports/StyleSheet\");\n  var StyleSheet = _interopDefault(_reactNativeWebDistExportsStyleSheet);\n  var _reactNativeWebview = require(_dependencyMap[3], \"react-native-webview\");\n  var _reactJsxDevRuntime = require(_dependencyMap[4], \"react/jsx-dev-runtime\");\n  const LeafletMap = ({\n    vehicles,\n    onMarkerClick,\n    center = [35.3764, 1.3218],\n    zoom = 13,\n    focusedVehicleImei = null,\n    mapType = 'leaflet'\n  }) => {\n    // Generate HTML for Leaflet map\n    const generateMapHTML = () => {\n      const vehiclesJSON = JSON.stringify(vehicles);\n      const centerJSON = JSON.stringify(vehicles && vehicles.length > 0 ? [vehicles[0].lat, vehicles[0].lng] : center);\n\n      // Define tile layers based on map type\n      let tileLayerConfig = '';\n      if (mapType === 'arcgis') {\n        tileLayerConfig = `\n        L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}', {\n          attribution: '© Esri, Maxar, Earthstar Geographics',\n          maxZoom: 19\n        }).addTo(map);\n      `;\n      } else if (mapType === 'mapbox') {\n        tileLayerConfig = `\n        L.tileLayer('https://api.mapbox.com/styles/v1/mapbox/satellite-v9/tiles/{z}/{x}/{y}?access_token=pk.eyJ1IjoibWFwYm94IiwiYSI6ImNpejY4NXVycTA2emYycXBndHRqcmZ3N3gifQ.rJcFIG214AriISLbB6B5aw', {\n          attribution: '© Mapbox © OpenStreetMap',\n          maxZoom: 19,\n          tileSize: 512,\n          zoomOffset: -1\n        }).addTo(map);\n      `;\n      } else {\n        tileLayerConfig = `\n        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {\n          attribution: '© OpenStreetMap contributors',\n          maxZoom: 19\n        }).addTo(map);\n      `;\n      }\n      return `\n<!DOCTYPE html>\n<html>\n<head>\n  <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no\" />\n  <link rel=\"stylesheet\" href=\"https://unpkg.com/leaflet@1.9.4/dist/leaflet.css\" />\n  <script src=\"https://unpkg.com/leaflet@1.9.4/dist/leaflet.js\"></script>\n  <style>\n    body, html { margin: 0; padding: 0; height: 100%; }\n    #map { height: 100%; width: 100%; }\n  </style>\n</head>\n<body>\n  <div id=\"map\"></div>\n  <script>\n    const vehicles = ${vehiclesJSON};\n    const center = ${centerJSON};\n    \n    // Initialize map\n    const map = L.map('map').setView(center, ${zoom});\n    \n    // Add selected tile layer\n    ${tileLayerConfig}\n    \n    // Add markers for each vehicle with arrow icons\n    vehicles.forEach(vehicle => {\n      // Create arrow SVG pointing in the direction of vehicle movement\n      const arrowSvg = \\`\n        <svg width=\"24\" height=\"30\" viewBox=\"0 0 24 30\" xmlns=\"http://www.w3.org/2000/svg\" \n             style=\"transform: rotate(\\${vehicle.angle}deg); filter: drop-shadow(0 1px 3px rgba(0,0,0,0.3));\">\n          <path d=\"M12 3 L21 18 L15 18 L15 27 L9 27 L9 18 L3 18 Z\" \n                fill=\"\\${vehicle.color}\" \n                stroke=\"white\" \n                stroke-width=\"1.5\"/>\n        </svg>\n      \\`;\n      \n      // Add vehicle name below the arrow\n      const icon = L.divIcon({\n        className: 'custom-vehicle-marker',\n        html: \\`\n          <div style=\"text-align: center; width: 60px; margin-left: -18px;\">\n            \\${arrowSvg}\n            <div style=\"\n              font-family: Arial, sans-serif;\n              font-size: 9px;\n              font-weight: bold;\n              color: #333;\n              background-color: rgba(255,255,255,0.95);\n              padding: 1px 3px;\n              border-radius: 3px;\n              margin-top: -3px;\n              box-shadow: 0 1px 2px rgba(0,0,0,0.2);\n              white-space: nowrap;\n              overflow: hidden;\n              text-overflow: ellipsis;\n            \">\\${vehicle.name}</div>\n          </div>\n        \\`,\n        iconSize: [24, 45],\n        iconAnchor: [12, 30]\n      });\n      \n      const marker = L.marker([vehicle.lat, vehicle.lng], { icon })\n        .addTo(map)\n        .bindPopup(\\`\n          <div style=\"min-width: 150px; font-family: Arial, sans-serif;\">\n            <strong style=\"font-size: 16px; color: #333;\">\\${vehicle.name}</strong><br/>\n            <span style=\"font-size: 14px; color: #666;\">Vitesse: \\${vehicle.speed.toFixed(0)} km/h</span><br/>\n            <span style=\"font-size: 14px; color: #666;\">Direction: \\${vehicle.angle.toFixed(0)}°</span><br/>\n            <span style=\"font-size: 14px; color: #666;\">Statut: \\${vehicle.status}</span>\n          </div>\n        \\`);\n        \n      marker.on('click', () => {\n        if (window.ReactNativeWebView) {\n          window.ReactNativeWebView.postMessage(JSON.stringify({\n            type: 'markerClick',\n            imei: vehicle.imei\n          }));\n        }\n      });\n    });\n    \n    // Fit bounds to show all vehicles\n    if (vehicles.length > 0) {\n      const bounds = vehicles.map(v => [v.lat, v.lng]);\n      map.fitBounds(bounds, { padding: [50, 50] });\n    }\n  </script>\n</body>\n</html>\n    `;\n    };\n    const handleMessage = event => {\n      try {\n        const data = JSON.parse(event.nativeEvent.data);\n        if (data.type === 'markerClick' && onMarkerClick) {\n          onMarkerClick(data.imei);\n        }\n      } catch (error) {\n        console.error('Error parsing WebView message:', error);\n      }\n    };\n    return /*#__PURE__*/(0, _reactJsxDevRuntime.jsxDEV)(View.default, {\n      style: styles.container,\n      children: /*#__PURE__*/(0, _reactJsxDevRuntime.jsxDEV)(_reactNativeWebview.WebView, {\n        source: {\n          html: generateMapHTML()\n        },\n        style: styles.webview,\n        onMessage: handleMessage,\n        javaScriptEnabled: true,\n        domStorageEnabled: true,\n        originWhitelist: ['*']\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 173,\n        columnNumber: 7\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 172,\n      columnNumber: 5\n    }, this);\n  };\n  _c = LeafletMap;\n  const styles = StyleSheet.default.create({\n    container: {\n      flex: 1\n    },\n    webview: {\n      flex: 1\n    }\n  });\n  var _default = LeafletMap;\n  var _c;\n  $RefreshReg$(_c, \"LeafletMap\");\n});","lineCount":209,"map":[[13,2,194,0,"Object"],[13,8,194,0],[13,9,194,0,"defineProperty"],[13,23,194,0],[13,24,194,0,"exports"],[13,31,194,0],[14,4,194,0,"enumerable"],[14,14,194,0],[15,4,194,0,"get"],[15,7,194,0],[15,18,194,0,"get"],[15,19,194,0],[16,6,194,0],[16,13,194,0,"_default"],[16,21,194,0],[17,4,194,0],[18,2,194,0],[19,2,25,0,"Object"],[19,8,25,0],[19,9,25,0,"defineProperty"],[19,23,25,0],[19,24,25,0,"exports"],[19,31,25,0],[20,4,25,0,"enumerable"],[20,14,25,0],[21,4,25,0,"get"],[21,7,25,0],[21,18,25,0,"get"],[21,19,25,0],[22,6,25,0],[22,13,25,0,"LeafletMap"],[22,23,25,0],[23,4,25,0],[24,2,25,0],[25,2,1,0,"require"],[25,9,1,0],[25,10,1,0,"_dependencyMap"],[25,24,1,0],[26,2,1,26],[26,6,1,26,"_reactNativeWebDistExportsView"],[26,36,1,26],[26,39,1,26,"require"],[26,46,1,26],[26,47,1,26,"_dependencyMap"],[26,61,1,26],[27,2,1,26],[27,6,1,26,"View"],[27,10,1,26],[27,13,1,26,"_interopDefault"],[27,28,1,26],[27,29,1,26,"_reactNativeWebDistExportsView"],[27,59,1,26],[28,2,1,26],[28,6,1,26,"_reactNativeWebDistExportsStyleSheet"],[28,42,1,26],[28,45,1,26,"require"],[28,52,1,26],[28,53,1,26,"_dependencyMap"],[28,67,1,26],[29,2,1,26],[29,6,1,26,"StyleSheet"],[29,16,1,26],[29,19,1,26,"_interopDefault"],[29,34,1,26],[29,35,1,26,"_reactNativeWebDistExportsStyleSheet"],[29,71,1,26],[30,2,3,0],[30,6,3,0,"_reactNativeWebview"],[30,25,3,0],[30,28,3,0,"require"],[30,35,3,0],[30,36,3,0,"_dependencyMap"],[30,50,3,0],[31,2,3,47],[31,6,3,47,"_reactJsxDevRuntime"],[31,25,3,47],[31,28,3,47,"require"],[31,35,3,47],[31,36,3,47,"_dependencyMap"],[31,50,3,47],[32,2,25,7],[32,8,25,13,"LeafletMap"],[32,18,25,50],[32,21,25,53,"LeafletMap"],[32,22,25,54],[33,4,26,2,"vehicles"],[33,12,26,10],[34,4,27,2,"onMarkerClick"],[34,17,27,15],[35,4,28,2,"center"],[35,10,28,8],[35,13,28,11],[35,14,28,12],[35,21,28,19],[35,23,28,21],[35,29,28,27],[35,30,28,28],[36,4,29,2,"zoom"],[36,8,29,6],[36,11,29,9],[36,13,29,11],[37,4,30,2,"focusedVehicleImei"],[37,22,30,20],[37,25,30,23],[37,29,30,27],[38,4,31,2,"mapType"],[38,11,31,9],[38,14,31,12],[39,2,32,0],[39,3,32,1],[39,8,32,6],[40,4,33,2],[41,4,34,2],[41,10,34,8,"generateMapHTML"],[41,25,34,23],[41,28,34,26,"generateMapHTML"],[41,29,34,26],[41,34,34,32],[42,6,35,4],[42,12,35,10,"vehiclesJSON"],[42,24,35,22],[42,27,35,25,"JSON"],[42,31,35,29],[42,32,35,30,"stringify"],[42,41,35,39],[42,42,35,40,"vehicles"],[42,50,35,48],[42,51,35,49],[43,6,36,4],[43,12,36,10,"centerJSON"],[43,22,36,20],[43,25,36,23,"JSON"],[43,29,36,27],[43,30,36,28,"stringify"],[43,39,36,37],[43,40,36,38,"vehicles"],[43,48,36,46],[43,52,36,50,"vehicles"],[43,60,36,58],[43,61,36,59,"length"],[43,67,36,65],[43,70,36,68],[43,71,36,69],[43,74,36,72],[43,75,36,73,"vehicles"],[43,83,36,81],[43,84,36,82],[43,85,36,83],[43,86,36,84],[43,87,36,85,"lat"],[43,90,36,88],[43,92,36,90,"vehicles"],[43,100,36,98],[43,101,36,99],[43,102,36,100],[43,103,36,101],[43,104,36,102,"lng"],[43,107,36,105],[43,108,36,106],[43,111,36,109,"center"],[43,117,36,115],[43,118,36,116],[45,6,38,4],[46,6,39,4],[46,10,39,8,"tileLayerConfig"],[46,25,39,23],[46,28,39,26],[46,30,39,28],[47,6,40,4],[47,10,40,8,"mapType"],[47,17,40,15],[47,22,40,20],[47,30,40,28],[47,32,40,30],[48,8,41,6,"tileLayerConfig"],[48,23,41,21],[48,26,41,24],[49,0,42,0],[50,0,43,0],[51,0,44,0],[52,0,45,0],[53,0,46,0],[53,7,46,7],[54,6,47,4],[54,7,47,5],[54,13,47,11],[54,17,47,15,"mapType"],[54,24,47,22],[54,29,47,27],[54,37,47,35],[54,39,47,37],[55,8,48,6,"tileLayerConfig"],[55,23,48,21],[55,26,48,24],[56,0,49,0],[57,0,50,0],[58,0,51,0],[59,0,52,0],[60,0,53,0],[61,0,54,0],[62,0,55,0],[62,7,55,7],[63,6,56,4],[63,7,56,5],[63,13,56,11],[64,8,57,6,"tileLayerConfig"],[64,23,57,21],[64,26,57,24],[65,0,58,0],[66,0,59,0],[67,0,60,0],[68,0,61,0],[69,0,62,0],[69,7,62,7],[70,6,63,4],[71,6,65,4],[71,13,65,11],[72,0,66,0],[73,0,67,0],[74,0,68,0],[75,0,69,0],[76,0,70,0],[77,0,71,0],[78,0,72,0],[79,0,73,0],[80,0,74,0],[81,0,75,0],[82,0,76,0],[83,0,77,0],[84,0,78,0],[85,0,79,0],[86,0,80,0],[86,23,80,23,"vehiclesJSON"],[86,35,80,35],[87,0,81,0],[87,21,81,21,"centerJSON"],[87,31,81,31],[88,0,82,0],[89,0,83,0],[90,0,84,0],[90,47,84,47,"zoom"],[90,51,84,51],[91,0,85,0],[92,0,86,0],[93,0,87,0],[93,6,87,6,"tileLayerConfig"],[93,21,87,21],[94,0,88,0],[95,0,89,0],[96,0,90,0],[97,0,91,0],[98,0,92,0],[99,0,93,0],[100,0,94,0],[101,0,95,0],[102,0,96,0],[103,0,97,0],[104,0,98,0],[105,0,99,0],[106,0,100,0],[107,0,101,0],[108,0,102,0],[109,0,103,0],[110,0,104,0],[111,0,105,0],[112,0,106,0],[113,0,107,0],[114,0,108,0],[115,0,109,0],[116,0,110,0],[117,0,111,0],[118,0,112,0],[119,0,113,0],[120,0,114,0],[121,0,115,0],[122,0,116,0],[123,0,117,0],[124,0,118,0],[125,0,119,0],[126,0,120,0],[127,0,121,0],[128,0,122,0],[129,0,123,0],[130,0,124,0],[131,0,125,0],[132,0,126,0],[133,0,127,0],[134,0,128,0],[135,0,129,0],[136,0,130,0],[137,0,131,0],[138,0,132,0],[139,0,133,0],[140,0,134,0],[141,0,135,0],[142,0,136,0],[143,0,137,0],[144,0,138,0],[145,0,139,0],[146,0,140,0],[147,0,141,0],[148,0,142,0],[149,0,143,0],[150,0,144,0],[151,0,145,0],[152,0,146,0],[153,0,147,0],[154,0,148,0],[155,0,149,0],[156,0,150,0],[157,0,151,0],[158,0,152,0],[159,0,153,0],[160,0,154,0],[161,0,155,0],[162,0,156,0],[163,0,157,0],[163,5,157,5],[164,4,158,2],[164,5,158,3],[165,4,160,2],[165,10,160,8,"handleMessage"],[165,23,160,21],[165,26,160,25,"event"],[165,31,160,35],[165,35,160,40],[166,6,161,4],[166,10,161,8],[167,8,162,6],[167,14,162,12,"data"],[167,18,162,16],[167,21,162,19,"JSON"],[167,25,162,23],[167,26,162,24,"parse"],[167,31,162,29],[167,32,162,30,"event"],[167,37,162,35],[167,38,162,36,"nativeEvent"],[167,49,162,47],[167,50,162,48,"data"],[167,54,162,52],[167,55,162,53],[168,8,163,6],[168,12,163,10,"data"],[168,16,163,14],[168,17,163,15,"type"],[168,21,163,19],[168,26,163,24],[168,39,163,37],[168,43,163,41,"onMarkerClick"],[168,56,163,54],[168,58,163,56],[169,10,164,8,"onMarkerClick"],[169,23,164,21],[169,24,164,22,"data"],[169,28,164,26],[169,29,164,27,"imei"],[169,33,164,31],[169,34,164,32],[170,8,165,6],[171,6,166,4],[171,7,166,5],[171,8,166,6],[171,15,166,13,"error"],[171,20,166,18],[171,22,166,20],[172,8,167,6,"console"],[172,15,167,13],[172,16,167,14,"error"],[172,21,167,19],[172,22,167,20],[172,54,167,52],[172,56,167,54,"error"],[172,61,167,59],[172,62,167,60],[173,6,168,4],[174,4,169,2],[174,5,169,3],[175,4,171,2],[175,24,172,4],[175,28,172,4,"_reactJsxDevRuntime"],[175,47,172,4],[175,48,172,4,"jsxDEV"],[175,54,172,4],[175,56,172,5,"View"],[175,60,172,9],[175,61,172,9,"default"],[175,68,172,9],[176,6,172,10,"style"],[176,11,172,15],[176,13,172,17,"styles"],[176,19,172,23],[176,20,172,24,"container"],[176,29,172,34],[177,6,172,34,"children"],[177,14,172,34],[177,29,173,6],[177,33,173,6,"_reactJsxDevRuntime"],[177,52,173,6],[177,53,173,6,"jsxDEV"],[177,59,173,6],[177,61,173,7,"_reactNativeWebview"],[177,80,173,14],[177,81,173,14,"WebView"],[177,88,173,14],[178,8,174,8,"source"],[178,14,174,14],[178,16,174,16],[179,10,174,18,"html"],[179,14,174,22],[179,16,174,24,"generateMapHTML"],[179,31,174,39],[179,32,174,40],[180,8,174,42],[180,9,174,44],[181,8,175,8,"style"],[181,13,175,13],[181,15,175,15,"styles"],[181,21,175,21],[181,22,175,22,"webview"],[181,29,175,30],[182,8,176,8,"onMessage"],[182,17,176,17],[182,19,176,19,"handleMessage"],[182,32,176,33],[183,8,177,8,"javaScriptEnabled"],[183,25,177,25],[183,27,177,27],[183,31,177,32],[184,8,178,8,"domStorageEnabled"],[184,25,178,25],[184,27,178,27],[184,31,178,32],[185,8,179,8,"originWhitelist"],[185,23,179,23],[185,25,179,25],[185,26,179,26],[185,29,179,29],[186,6,179,31],[187,8,179,31,"fileName"],[187,16,179,31],[187,18,179,31,"_jsxFileName"],[187,30,179,31],[188,8,179,31,"lineNumber"],[188,18,179,31],[189,8,179,31,"columnNumber"],[189,20,179,31],[190,6,179,31],[190,13,180,7],[191,4,180,8],[192,6,180,8,"fileName"],[192,14,180,8],[192,16,180,8,"_jsxFileName"],[192,28,180,8],[193,6,180,8,"lineNumber"],[193,16,180,8],[194,6,180,8,"columnNumber"],[194,18,180,8],[195,4,180,8],[195,11,181,10],[195,12,181,11],[196,2,183,0],[196,3,183,1],[197,2,183,2,"_c"],[197,4,183,2],[197,7,25,13,"LeafletMap"],[197,17,25,50],[198,2,185,0],[198,8,185,6,"styles"],[198,14,185,12],[198,17,185,15,"StyleSheet"],[198,27,185,25],[198,28,185,25,"default"],[198,35,185,25],[198,36,185,26,"create"],[198,42,185,32],[198,43,185,33],[199,4,186,2,"container"],[199,13,186,11],[199,15,186,13],[200,6,187,4,"flex"],[200,10,187,8],[200,12,187,10],[201,4,188,2],[201,5,188,3],[202,4,189,2,"webview"],[202,11,189,9],[202,13,189,11],[203,6,190,4,"flex"],[203,10,190,8],[203,12,190,10],[204,4,191,2],[205,2,192,0],[205,3,192,1],[205,4,192,2],[206,2,194,0],[206,6,194,0,"_default"],[206,14,194,0],[206,17,194,15,"LeafletMap"],[206,27,194,25],[207,2,194,26],[207,6,194,26,"_c"],[207,8,194,26],[208,2,194,26,"$RefreshReg$"],[208,14,194,26],[208,15,194,26,"_c"],[208,17,194,26],[209,0,194,26],[209,3]],"functionMap":{"names":["<global>","LeafletMap","generateMapHTML","handleMessage"],"mappings":"AAA;qDCwB;0BCS;GD4H;wBEE;GFS;CDc"},"hasCjsExports":false},"type":"js/module"}]}